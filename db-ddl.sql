-- Date:    2022-05-11
-- Author:  Christopher Mortimer
-- Desc:    Setup the schema and tables for the NFL data on Postgres

drop table if exists mortimer_nfl.PLAYER;
drop table if exists mortimer_nfl.GAME_STATS;
drop table if exists mortimer_nfl.TEAM_LOOKUP;
drop table if exists mortimer_nfl.WEATHER;
drop table if exists mortimer_nfl.GAME_VENUE;
drop table if exists mortimer_nfl.VENUE;
drop table if exists mortimer_nfl.GAME;
drop table if exists mortimer_nfl.GAME_TYPE;

create table mortimer_nfl.GAME_TYPE (
  GAME_TYPE_ID INTEGER NOT NULL
  , GAME_TYPE CHAR(3)
  , CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  , CREATE_USER VARCHAR(50)
  , CONSTRAINT GAME_TYPE_ID_PK PRIMARY KEY (GAME_TYPE_ID)
)
;

-- GAME
create table mortimer_nfl.GAME (
  GAME_ID INTEGER NOT NULL
  , GAME_TYPE_ID INTEGER NOT NULL
  , WEEK INTEGER
  , HOME_TEAM_ID INTEGER
  , AWAY_TEAM_ID INTEGER
  , CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  , CREATE_USER VARCHAR(50)
  , CONSTRAINT GAME_ID_PK PRIMARY KEY (GAME_ID)
  , CONSTRAINT GAME_GAME_TYPE_ID_FK FOREIGN KEY (GAME_TYPE_ID)
      REFERENCES mortimer_nfl.GAME_TYPE (GAME_TYPE_ID)
)
;

-- VENUE
create table mortimer_nfl.VENUE (
  VENUE_ID INTEGER NOT NULL
  , VENUE_NAME VARCHAR(50)
  , CAPACITY INTEGER
  , SURFACE VARCHAR(50)
  , VENUE_TYPE VARCHAR(50)
  , CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  , CREATE_USER VARCHAR(50)
  , CONSTRAINT VENUE_ID_PK PRIMARY KEY (VENUE_ID)
)
;

-- GAME_VENUE
create table mortimer_nfl.GAME_VENUE (
  GAME_VENUE_ID INTEGER NOT NULL
  , GAME_ID INTEGER NOT NULL
  , VENUE_ID INTEGER NOT NULL
  , CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  , CREATE_USER VARCHAR(50)
  , CONSTRAINT GAME_VENUE_ID_PK PRIMARY KEY (GAME_VENUE_ID)
  , CONSTRAINT GAME_VENUE_GAME_ID_FK FOREIGN KEY (GAME_ID)
      REFERENCES mortimer_nfl.GAME (GAME_ID)
  , CONSTRAINT GAME_VENUE_VENUE_ID_FK FOREIGN KEY (VENUE_ID)
      REFERENCES mortimer_nfl.VENUE (VENUE_ID)
)
;

-- WEATHER
create table mortimer_nfl.WEATHER (
  WEATHER_GAME_ID INTEGER NOT NULL
  , GAME_ID INTEGER NOT NULL
  , TEMPERATURE INTEGER
  , WEATHER_CONDITION VARCHAR(50)
  , WIND_SPEED INTEGER
  , HUMIDITY INTEGER
  , WIND_DIRECTION CHAR(3)
  , CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  , CREATE_USER VARCHAR(50)
  , CONSTRAINT WEATHER_GAME_ID_PK PRIMARY KEY (WEATHER_GAME_ID)
  , CONSTRAINT WEATHER_GAME_ID_FK FOREIGN KEY (GAME_ID)
      REFERENCES mortimer_nfl.GAME (GAME_ID)
)
;

-- TEAM_LOOKUP
create table mortimer_nfl.TEAM_LOOKUP (
  TEAM_ID INTEGER NOT NULL
  , TEAM VARCHAR(50)
  , TEAM_SHORT CHAR(3)
  , CONFERENCE CHAR(3)
  , DIVISION VARCHAR(10)
  , CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  , CREATE_USER VARCHAR(50)
  , CONSTRAINT TEAM_ID_PK PRIMARY KEY (TEAM_ID)
)
;

-- GAME_STATS
create table mortimer_nfl.GAME_STATS (
  GAME_TEAM_ID INTEGER NOT NULL
  , GAME_ID INTEGER NOT NULL
  , TEAM_ID INTEGER NOT NULL
  , TOTAL_FIRST_DOWNS INTEGER
  , PASSING_FIRST_DOWNS INTEGER
  , RUSHING_FIRST_DOWNS INTEGER
  , PENALTY_FIRST_DOWNS INTEGER
  , THIRD_DOWN_ATTEMPTS INTEGER
  , THIRD_DOWN_CONVERSIONS INTEGER
  , THIRD_DOWN_CONVERSION_PERC DECIMAL(10,5)
  , THIRD_DOWN_PASSING_CONVERSIONS INTEGER
  , THIRD_DOWN_RUSHING_CONVERSIONS INTEGER
  , THIRD_DOWN_PENALTY_CONVERSIONS INTEGER
  , FOURTH_DOWN_ATTEMPTS INTEGER
  , FOURTH_DOWN_CONVERSIONS INTEGER
  , FOURTH_DOWN_CONVERSION_PERC DECIMAL(10,5)
  , FOURTH_DOWN_PASSING_CONVERSIONS INTEGER
  , FOURTH_DOWN_RUSHING_CONVERSIONS INTEGER
  , FOURTH_DOWN_PENALTY_CONVERSIONS INTEGER
  , TOTAL_PLAYS INTEGER
  , TOTAL_YARDS INTEGER
  , YARDS_PER_PLAY DECIMAL(10,5)
  , RUSHING_PLAYS INTEGER
  , RUSHING_YARDS INTEGER
  , RUSHING_YARDS_PER_PLAY DECIMAL(10,5)
  , PASSING_PLAYS INTEGER
  , PASSING_COMPLETIONS INTEGER
  , PASSING_YARDS_PER_PLAY DECIMAL(10,5)
  , INTERCEPTIONS INTEGER
  , SACKS INTEGER
  , NET_PASSING_YARDS INTEGER
  , GROSS_PASSING_YARDS INTEGER
  , SACK_YARDS INTEGER
  , TOTAL_RETURN_YARDS INTEGER
  , PUNT_RETURNS INTEGER
  , PUNT_RETURN_YARDS INTEGER
  , KICK_OFF_RETURNS INTEGER
  , KICK_OFF_RETURN_YARDS INTEGER
  , INTERCEPTION_RETURNS INTEGER
  , INTERCEPTION_RETURN_YARDS INTEGER
  , KICK_OFFS INTEGER
  , KICK_OFFS_IN_ENDZONE INTEGER
  , TOUCHBACKS INTEGER
  , PUNTS INTEGER
  , AVERAGE_PUNT_YARDS DECIMAL(10,5)
  , PUNTS_BLOCKED INTEGER
  , AVERAGE_NET_PUNT_YARDS DECIMAL(10,5)
  , PENALTIES INTEGER
  , PENALTY_YARDS INTEGER
  , FUMBLES INTEGER
  , FUMBLES_LOST INTEGER
  , TOTAL_TD INTEGER
  , PASSING_TD INTEGER
  , RUSHING_TD INTEGER
  , INTERCEPTION_TD INTEGER
  , FUMBLE_TD INTEGER
  , PUNT_RETURN_TD INTEGER
  , KICK_OFF_RETURN_TD INTEGER
  , FIELD_GOAL_RETURN_TD INTEGER
  , EXTRA_POINT_ATTEMPTS INTEGER
  , EXTRA_POINTS_MADE INTEGER
  , EXTRA_POINTS_BLOCKED INTEGER
  , TWO_POINT_CONVERSION_ATTEMPTS INTEGER
  , TWO_POINT_CONVERSIONS_MADE INTEGER
  , FIELD_GOAL_ATTEMPTS INTEGER
  , FIELD_GOALS_MADE INTEGER
  , FIELD_GOALS_BLOCKED INTEGER
  , REDZONE_VISITS INTEGER
  , REDZONE_TD INTEGER
  , REDZONE_EFFICIENCY DECIMAL(10,5)
  , GOAL_TO_GO_ATTEMPTS INTEGER
  , GOAL_TO_GO_TD INTEGER
  , GOAL_TO_GO_EFFICIENCY INTEGER
  , SAFETIES INTEGER
  , TURNOVERS INTEGER
  , POINTS_SCORED INTEGER
  , TIME_OF_POSSESION INTERVAL
  , WIN_LOSS CHAR(1)
  , CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  , CREATE_USER VARCHAR(50)
  , CONSTRAINT GAME_TEAM_ID_PK PRIMARY KEY (GAME_TEAM_ID)
  , CONSTRAINT GAME_STATS_GAME_ID_FK FOREIGN KEY (GAME_ID)
      REFERENCES mortimer_nfl.GAME (GAME_ID)
  , CONSTRAINT GAME_STATS_TEAM_ID_FK FOREIGN KEY (TEAM_ID)
      REFERENCES mortimer_nfl.TEAM_LOOKUP (TEAM_ID)
)
;

-- PLAYER
create table mortimer_nfl.PLAYER (
  GAME_PLAYER_ID INTEGER NOT NULL
  , WEEK INTEGER
  , GAME_ID INTEGER NOT NULL
  , TEAM_ID INTEGER NOT NULL
  , HOME_AWAY VARCHAR(50) NULL
  , PLAYER_NAME VARCHAR(100) NOT NULL
  , FIELD_POSITION CHAR(3) NULL
  , RUSHING_ATTEMPTS INTEGER NULL
  , RUSHING_YARDS INTEGER NULL
  , RUSHING_TD INTEGER NULL
  , RECEIVING_TARGETS INTEGER NULL
  , RECEPTIONS INTEGER NULL
  , RECEIVING_YARDS INTEGER NULL
  , RECEIVING_TD INTEGER NULL
  , TOTAL_TD INTEGER NULL
  , FUMBLES INTEGER NULL
  , PASS_ATTEMPTS INTEGER NULL
  , PASS_COMPLETIONS INTEGER NULL
  , PASSING_YARDS INTEGER NULL
  , PASSING_TD INTEGER NULL
  , INTERCEPTIONS INTEGER NULL
  , CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  , CREATE_USER VARCHAR(50)
  , CONSTRAINT GAME_PLAYER_ID_PK PRIMARY KEY (GAME_PLAYER_ID)
  , CONSTRAINT PLAYER_GAME_ID_FK FOREIGN KEY (GAME_ID)
      REFERENCES mortimer_nfl.GAME (GAME_ID)
  , CONSTRAINT PLAYER_TEAM_ID_FK FOREIGN KEY (TEAM_ID)
      REFERENCES mortimer_nfl.TEAM_LOOKUP (TEAM_ID)
) 
;